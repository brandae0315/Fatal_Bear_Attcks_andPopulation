<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Fatal Bear Attacks 2000-2025</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.0/dist/leaflet.css"/>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.14.0/css/all.css">
    <link href="https://fonts.googleapis.com/css?family=Titillium+Web" rel="stylesheet">
    <style>
    html, body, #map { width: 100%; height: 100%; margin: 0; background: #fff; }
    .legend {
line-height: 40px;
font-family: 'Titillium Web', sans-serif;
font-size: 16px;
width: 190px;
color: #333333;
padding: 6px 8px;
background: white;
background: rgba(255,255,255,0.5);
box-shadow: 0 0 15px rgba(0,0,0,0.2);
border-radius: 5px;
}
.legend i {
width: 20px;
height: 20px;
float: left;
margin-right: 8px;
opacity: 0.9;
}
.legend img {
width: 16px;
height: 16px;
margin-right: 3px;
float: left;
}
.legend p {
font-size: 14px;
line-height: 20px;
margin: 0;
}
    </style>
    <script src="https://unpkg.com/leaflet@1.7.0/dist/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-ajax/2.1.0/leaflet.ajax.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/chroma-js/1.3.4/chroma.min.js"></script>
</head>
<body>
<!-- Our web map and content will go here -->
<div id="map"></div>
<script>
// 1. Create a map object.
var mymap = L.map('map', {
    center: [48.654241, -101.133493], //note that we've centered the map to downtown AVL
    zoom: 2.8, //this line adjusts the starting zoom level of the map
    maxZoom: 18,//this line sets the maximum zoom level
    minZoom: 2,//this line sets the minimum zoom level
    detectRetina: true // detect whether the sceen is high resolution or not.
});

// 2. Add a base map.
L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png', {
    attribution: 'Fatal U.S. Bear Attacks | Base Map &copy; CartoDB | Map Author: Alexandra Brand'
}).addTo(mymap);

// 3. Add Airbnb GeoJSON Data
// Null variable that will hold Airbnb data
var bear_attacks = null;
// add several extra spaces here.

//steps 4, 5, etc. will be inserted in this line location.
// 4. define explicit CSS classes for bear types so we can force Black to be black
var typeClasses = {
    'Brown': { cls: 'marker-brown', color: '#A0522D' },
    'Black': { cls: 'marker-black', color: '#000000' },
    'Polar': { cls: 'marker-polar', color: '#d3d3d3' }
};

Object.keys(typeClasses).forEach(function(k) {
    var item = typeClasses[k];
    var css1 = '.' + item.cls + ' { color: ' + item.color + '; font-size: 18px !important; line-height: 20px; width: 24px; height: 24px; display: inline-block; text-align: center; }';
    var css2 = '.' + item.cls + ' i { color: inherit; font-size: inherit; line-height: inherit; }';
    $('head').append('<style>' + css1 + css2 + '</style>');
});

// Get GeoJSON and put it on the map when it loads
// Make sure you have the correct directory path below
// Use pointToLayer to create custom markers
var bear_attacks = L.geoJson.ajax('assets/bear_attacks.geojson', {
    pointToLayer: function(feature, latlng) {
        var bearType = (feature && feature.properties && feature.properties.bear_type) ? feature.properties.bear_type : null;
        var cls = 'marker-other';
        if (bearType && typeClasses[bearType]) cls = typeClasses[bearType].cls;

        var icon = L.divIcon({
            className: cls,
            html: '<i class="fa fa-paw"></i>',
            iconSize: [24, 24],
            iconAnchor: [12, 12]
        });

        return L.marker(latlng, { icon: icon });
    }
}).addTo(mymap);

var colors = chroma.scale('Reds').colors(6);

function setColor(bear_population) {
var id = 0;
if (bear_population > 100000) id = 5;
else if (bear_population > 24000) id = 4;
else if (bear_population > 7750) id = 3;
else if (bear_population > 2500) id = 2;
else if (bear_population > 0) id = 1;
else id = 0;
return colors[id];
}

function style(feature) {
var d = feature && feature.properties && (feature.properties.bear_population || feature.properties.bear_pop || feature.properties.population || 0);
return {
fillColor: setColor(Number(d) || 0),
fillOpacity: 0.7,
weight: 1,
opacity: 1,
color: '#b4b4b4'
};
}

// Function to bind popup for each state
function onEachFeature(feature, layer) {
    if (feature.properties && (feature.properties.bear_population || feature.properties.bear_pop || feature.properties.population)) {
        var pop = feature.properties.bear_population || feature.properties.bear_pop || feature.properties.population;
        layer.bindPopup("<b>Bear Population:</b> " + pop.toLocaleString());
    }
}

L.geoJson.ajax("assets/map.geojson", {
style: style,
onEachFeature: onEachFeature
}).addTo(mymap);

// 9. Create Leaflet Control Object for Legend
var legend = L.control({position: 'topright'});
// 10. Function that runs when legend is added to map
legend.onAdd = function () {
// Create Div Element and Populate it with HTML
var div = L.DomUtil.create('div', 'legend');
//this line creates a title for the choropleth part of the legend
div.innerHTML += '<b>Bear Population Per State</b><br />';
//notice the class breaks entered at the end of the next 5 lines
//the colors specify the shade of purple that we used to do the polygon shading
div.innerHTML += '<i style="background: ' + colors[4] + '; opacity: 0.5"></i><p>100000+</p>';
div.innerHTML += '<i style="background: ' + colors[3] + '; opacity: 0.5"></i><p>24001-100000</p>';
div.innerHTML += '<i style="background: ' + colors[2] + '; opacity: 0.5"></i><p>7751-24000</p>';
div.innerHTML += '<i style="background: ' + colors[1] + '; opacity: 0.5"></i><p>2501-7750</p>';
div.innerHTML += '<i style="background: ' + colors[0] + '; opacity: 0.5"></i><p> 0-2500</p>';
//this line provides the legend title for the airbnb colored symbols
div.innerHTML += '<hr><b>Type of Bear</b><br />';
//the next 3 lines call the airbnb icon along with its proper color
//notice the names of the Airbnb property types listed within the <p> tags at the end of the lines
div.innerHTML += '<i class="fa fa-paw marker-brown"></i><p>Brown Bear</p>';
div.innerHTML += '<i class="fa fa-paw marker-black"></i><p>Black Bear</p>';
div.innerHTML += '<i class="fa fa-paw marker-polar"></i><p>Polar Bear</p>';
// Return the Legend div containing the HTML content
return div;
};
// 11. Add a legend to map
legend.addTo(mymap);

L.control.scale({position: 'bottomleft'}).addTo(mymap);
</script>
</body>
</html>